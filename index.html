<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Global SM Plant Status (Made by LAM)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #0A2647; --accent: #1597BB; --trouble: #1A1A1B; --bg: #F0F5F9; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        
        /* 메인 레이아웃 */
        #container { display: flex; height: 100vh; width: 100vw; position: relative; }
        #map { flex-grow: 1; height: 100%; background: #DAEAF1; }

        /* 슬라이딩 사이드바 */
        #sidebar {
            position: absolute; left: 0; top: 0; width: 380px; height: 100%;
            background: white; z-index: 2000; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column;
        }
        #sidebar.hidden { transform: translateX(-100%); }

        /* 사이드바 토글 버튼 */
        #toggle-btn {
            position: absolute; right: -45px; top: 20px; width: 45px; height: 45px;
            background: var(--primary); color: white; border: none; cursor: pointer;
            border-radius: 0 8px 8px 0; font-size: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        /* BI 헤더 & 요약 */
        .sidebar-header { background: var(--primary); color: white; padding: 25px; }
        .sidebar-header h1 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
        .summary-box { background: var(--accent); color: white; padding: 15px 25px; display: flex; justify-content: space-between; }
        .summary-item span { display: block; font-size: 0.75rem; opacity: 0.8; }
        .summary-item strong { font-size: 1.2rem; }

        /* 리스트 영역 */
        #list-container { flex-grow: 1; overflow-y: auto; padding: 15px; background: var(--bg); }
        .plant-card {
            background: white; border-radius: 10px; padding: 15px; margin-bottom: 12px;
            border-left: 5px solid var(--accent); cursor: pointer; transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .plant-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .plant-card.issue { border-left-color: var(--trouble); background: #fdfdfd; }
        .name { font-weight: bold; color: var(--primary); margin-bottom: 5px; font-size: 1rem; }
        .info { font-size: 0.85rem; color: #666; display: flex; justify-content: space-between; }
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; color: white; }

        /* 팝업 커스텀 */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 5px; }
    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        <button id="toggle-btn" onclick="toggleSidebar()">☰</button>
        <div class="sidebar-header">
            <h1>Global SM Plant Status</h1>
            <p style="margin:5px 0 0 0; font-size:0.8rem; opacity:0.7;">Dashboard Created by LAM</p>
        </div>
        <div class="summary-box">
            <div class="summary-item"><span>Global Capacity</span><strong>42.5M MT</strong></div>
            <div class="summary-item" style="text-align:right;"><span>Current Loss</span><strong id="loss-total">0 MT</strong></div>
        </div>
        <div id="list-container">
            </div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. 데이터 내장 (보안 문제 없이 즉시 실행 가능)
    const plantData = [
        { name: "Anhui Haoyuan Chemical", city: "Fuyang", addr: "No.1 Yuanfeng Road...", capa: 260, status: "Normal", loss: 0, lat: 32.91, lng: 115.86 },
        { name: "Bora LyondellBasell", city: "Panjin", addr: "Binhai Road, Liaodong Bay...", capa: 350, status: "Normal", loss: 0, lat: 40.71, lng: 122.12 },
        { name: "Fujian Gulei Petrochemical", city: "Zhangzhou", addr: "Gulei Avenue, Gulei Port...", capa: 600, status: "Maintenance", loss: 100, lat: 23.93, lng: 117.61 },
        { name: "Tianjin Bohua Chemical", city: "Binhai", addr: "Nangang 1st St...", capa: 450, status: "Trouble", loss: 120, lat: 38.68, lng: 117.65 },
        { name: "Zhejiang Petroleum & Chem", city: "Zhoushan", addr: "Yushan Island Base...", capa: 2400, status: "Normal", loss: 0, lat: 30.34, lng: 122.15 },
        { name: "Kuwait Styrene", city: "Shuaiba", addr: "Shuaiba Industrial Area", capa: 525, status: "Trouble", loss: 85, lat: 29.03, lng: 48.11 },
        { name: "Petrokemya (SABIC)", city: "Al Jubail", addr: "Al Jubail Industrial City", capa: 1120, status: "Trouble", loss: 150, lat: 27.01, lng: 49.62 },
        { name: "Repsol", city: "Tarragona", addr: "Polígon Industrial Sud", capa: 450, status: "Maintenance", loss: 65, lat: 41.11, lng: 1.21 },
        { name: "Lotte Chemical", city: "Daesan", addr: "Daesan-eup, Seosan-si", capa: 580, status: "Normal", loss: 0, lat: 37.03, lng: 126.35 },
        { name: "Hanwha TotalEnergies", city: "Daesan", addr: "Daesan-eup, Seosan-si", capa: 650, status: "Normal", loss: 0, lat: 37.04, lng: 126.36 }
    ];

    // 2. 지도 초기화
    const map = L.map('map', { zoomControl: false }).setView([30, 110], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('hidden');
    }

    let totalLoss = 0;
    const listContainer = document.getElementById('list-container');

    // 3. 마커 및 리스트 생성
    plantData.forEach(p => {
        const isIssue = p.status !== 'Normal';
        const color = isIssue ? '#1A1A1B' : '#1597BB'; // 가동중지/보수는 검은색
        const radius = Math.sqrt(p.capa) * 1.5;

        // 지도 마커 추가
        const marker = L.circleMarker([p.lat, p.lng], {
            radius: radius, fillColor: color, color: 'white', weight: 2, fillOpacity: 0.8
        }).addTo(map);

        const popupContent = `
            <div style="font-family:sans-serif;">
                <h3 style="margin:0; color:${color}">${p.name}</h3>
                <p style="margin:5px 0; font-size:0.85rem;"><b>City:</b> ${p.city}<br><b>Capacity:</b> ${p.capa}K MT</p>
                <span style="font-size:0.8rem; font-weight:bold; color:${isIssue?'red':'green'}">${p.status}</span>
            </div>
        `;
        marker.bindPopup(popupContent);

        // 리스트 아이템 추가
        const card = document.createElement('div');
        card.className = `plant-card ${isIssue ? 'issue' : ''}`;
        card.innerHTML = `
            <div class="name">${p.name}</div>
            <div class="info">
                <span>${p.city} (${p.capa}K)</span>
                <span class="badge" style="background:${color}">${p.status}</span>
            </div>
        `;

        // 리스트 클릭 시 이동 로직 (Tracking)
        card.onclick = () => {
            map.flyTo([p.lat, p.lng], 9, { duration: 1.5 });
            marker.openPopup();
        };
        listContainer.appendChild(card);

        if(isIssue) totalLoss += p.loss;
    });

    document.getElementById('loss-total').innerText = totalLoss + "K MT";
</script>
</body>
</html>
